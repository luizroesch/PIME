library(tidyverse)
library(pime)
set.seed(2124)
restroom
sep=pime.split.by.variable(restroom, "Environment")
prev=pime.prevalence(sep)
prev
library(tictoc)
tic()
best2=pime.best.prevalence(prev, "Environment")
toc()
best2


library(phyloseq)
library(ranger)

gs <- as(object = sample_data(prev$`55`), Class = "data.frame")
Variable = as.factor(gs[, "Environment"])
response = Variable
train=t(otu_table(prev$`55`))
# Combine them into 1 data frame
training.set <- data.frame(response, train)
train.model = ranger::ranger(response ~ ., data = training.set, importance = "permutation")
oob=train.model$prediction.error
oob

variable.imp=train.model$variable.importance %>% sort(decreasing = T)

otu.imp=data.frame(variable.imp) %>% rownames_to_column(.,var = "SequenceID")
k=otu.imp %>% filter(variable.imp > mean(variable.imp))

sum(k$variable.imp)
sum(otu.imp$variable.imp)

